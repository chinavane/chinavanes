# 13.支付订单

对于用户已经最终确认的订单剩下的工作当然只是支付的工作，而之前已经提及目前网络平台常见的支付方式包括银行支付、第三方平台支付以及聚合支付等不同的支付方式。

## 1)银行支付

如果要使用银行支付则一定要明确合作的有哪些银行，中行、工行、农行、建行以及其他的商业银行包括兴业、交通等等银行都是独立合作对象，平台想要支持众多的银行支付就必须逐一和每家银行建立起合作关系，签订支付通道的协议，这其中每家银行对于平台合作的通道费率还存在一定的不同。所以，从这一商业合作的流程来看，单独的银行支付在商业洽谈阶段就是一个非常巨大的工程。而且，就算能够与众多银行进行成功洽谈签订合作协议，那么对于技术部门进行接口对接也将是一个非常繁杂的工作，显然每家银行所提供的支付接口不会相同，所以平台的技术部门中前后端开发人员需要对不同的银行与其接口进行指定目标的开发才能够适应不同银行的不同接口标准。更为关键的一点是，单独的银行支付方式对用户群体也是有局限性约束。如果平台提供的是工行支付，那么是否要求用户只能使用工行帐号支付模式？如果用户恰巧没有工行帐号，是否就意味着用户在平台无法实现商品的购买操作？最后，如果确认平台对接的是单独银行支付，很有可能用户将资金打入的是银行指定的但却是平台所属的独立账号，如果交易没有问题还好，如果交易出现了纠纷，那么很难保证用户资金的安全，因为资金是直接打到平台帐号，也没有第三方作以中介于璇。 所以，目前的网络平台项目基本已经很少有单独的银行支付操作模式了。

## 2)第三方支付

对比银行支付的减少，以微信支付、支付宝支付为案例的第三方支付在各种不同的平台大量的被应用广泛被推广使用。这是因为微信、支付宝这些第三方平台承担起了中间商角色，由他们一方与各个不同的银行进行银行支付的合作对接，并且针对各个银行进行不同的接口对接操作，只不过最终汇结成一个对外的支付操作接口。这时企业平台只需要和微信、支付宝这样的第三方平台达成合作协议，并且只需要接入他们一家的支付接口就可以使用第三方平台中的所有银行支付方式，并且用户并不会有单独银行支付的印象，只存留微信、支付宝支付的感受。微信、支付宝接口的支付流程是一个比较复杂的过程，因为它们需要承担起中间商甚至担保人的角色。企业平台中的订单资金用户在进行支付转帐时其实是直接汇入第三方支付平台的，并不会转入商户平台，而商户平台与第三方支付平台之间的资金关系是属于资金提现方式，因为存在支付通道使用费率问题，商户在提现时通道费用其实早已被扣除了。第三方支付中间商与担保人角色的存在其实可以将资金安全进行一个更为妥贴的保证，如果用户与商户之间出现交易纠纷，第三方平台还可以出面进行调解，不光可以保证用户的商品交易的安全性，又可以保证商户订单的合理合法性。

下面以微信支付为例，在时序图中用户想要实现商品订单的支付操作需要经历 20 多个操作的步骤，将其中的步骤进行汇总主要可以划分为：

- 订单支付的发起获取后台返回的带签名支付信息（前台）
- 预支付订单的生成（后端）
- 签名支付信息的返回（后端）
- 确认后端返回的签名支付信息后进行支付的发起确认（前台）
- 将资金支付到类似微信的第三方支付平台，由第三方平台通知商户是否支付成功（第三方）
- 商户确认订单状态以后请求第三方支付平台告知用户订单支付结果（后端）
- 用户可以通过商户请求第三方平台进行订单状态的支付结果查询（前台、后端、第三方）

需要明确的概念是：

- 用户的资金最终转入的是第三方平台，用户与商户不存在直接资金关联
- 资金打给谁就应该由谁负责确认与通知
- 第三方平台应该主动通知商户与用户支付是否已经成功，而不是由他们进行询问处理

第三方支付操作虽然功能十分的强大能够解决企业商户的支付问题，但是企业平台仍旧需要进行不同平台不同接口开发处理，像微信支付、支付宝支付、银联支付等，至少要实现几个不同的第三平台的独立接口对接处理，显然这些第三方平台的支付接口操作流程也会存在差异，代码结构也一定会产生不同。这样的结果对于中小型团队没有更多开发人员的情况下压力还是比较重的。

![image-20220823074101715](http://qn.chinavanes.com/qiniu_picGo/image-20220823074101715.png)

## 3)聚合支付

针对于商家平台需要衔接多个第三方平台但却没有更多的技术力量支撑的情况，第四方的聚合支付也许是一种比较好的选择，而且聚合支付还可以帮助商家平台解决跨境、多级代理、多门店等具有总、分模式的平台交易模式订单。聚合支付其实是在第三方支付的基础上再进行业务的汇总集成与扩展，第三方支付汇总的是单个的银行支付，而聚合支付则汇总的是第三方支付。如此一来，聚合支付将第三方支付的接口模式进行了进一步的集成与封装，给商家提供单独入口的支付接口，而这一支付接口却可以自动匹配终端用户的不同支付方式，比如用户使用微信支付则聚合支付将启用微信支付通道，用户使用支付宝支付则自动实现支付宝支付的收款处理。

聚合支付还可以协助解决商户平台的多级分销或者多级子店的划分管理，因为很多的商户平台是属于 B2B2C 的操作模式，平台下属并不是直接面对终端消费者，他们的下级仍旧是商家级别，这时候是否考虑需要给每个商家都进行单独的微信、支付宝对接就是一个麻烦的问题，所以利用第四方聚合支付就可以给电商平台下属的商家进行简单配置处理，然后就可以实现大平台下子商户里的终端用户订单支付操作。
