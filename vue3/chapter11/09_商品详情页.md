# 09.商品详情页

商品详情页的内容是对商品基础信息的展示，包括商品名称、介绍、价格、图片、介绍等基本信息内容，但是商品详情中还是会有一些略显复杂的概念与操作，比如商品的销售属性 SKU，因为 SKU 属性在切换的时候将会影响的是商品的销售价格以及商品库存量。还有将商品加入购物车的操作，需要确认的是使用状态管理操作还是接口请求处理又或者是两者的相互结合应用。至于商品图片的展示可能会涉及轮播图插件的再次应用以及放大镜效果的处理等。

![image-20220821133105016](http://qn.chinavanes.com/qiniu_picGo/image-20220821133105016.png)

## 1)商品 SKU 销售属性的价格切换

商品详情最重要的一个概念就是 SKU 销售属性的理解，因为在进行商品 SKU 销售属性切换的时候是会影响到商品价格与库存量改变的。比如黑色的手机在与电信版本进行套餐捆绑的时候可能是一个价格，并且它的现有商品库存量是一定的数量，但是黑色的手机在与移动版本进行套餐捆绑的时候可能是另一个价格，并且它的现有商品库存量与电信版的库存量还不一定一致。商品的 SKU 影响到的价格与库存是一个笛卡尔积的结果值，比如现在的手机有黑、白、青三种不同的颜色，而手机套餐则有电信、移动、联通三种不同的套餐，那么这时候的商品的价格与库存量应该是 3\*3 最多为 9 种不同的价格与库存量，分别是：黑/电信、黑/移动、黑/联通、白/电信、白/移动、白/联通、青/电信、青/移动、青/联通这 9 种不同的组合，这些组合的价格有可能是完全不一致，也有可能存在相同，如果某种组合的商品没有进货的话，那么库存量为 0 则应该进行商品下架操作，将无法实现商品的购买。一般 SKU 的种类与数量有着一定数量的限制，试想一下，如果一个商品有个十几个 SKU 的种类，每个 SKU 种类中又有十几个 SKU 属性的话，那么这一商品将会包含多少个商品的数量与库存量的操作呢？如果光一个商品就有上百个 SKU 销售属性的话这将不光涉及到商品 SKU 销售属性的设置繁杂性还会涉及到 SKU 销售属性对于整体系统性能的影响。那么具体 SKU 种类与数量是多少适合呢？这得根据不同的平台系统具体查看需求，不过一般不会建议种类超过 4、5 种，每种数量也不会过多。

## 2)图片展示与放大查看

在进行商品详情页信息展示的时候，为了增加商品的吸引力，引起用户更多的关注与购买欲，通常会对商品进行多个不同角度的照片拍摄以及展示操作，以便让用户查看到商品的细节品质，这就需要使用轮播图插件功能。事实上 Swiper 插件的功能十分的强大，所以在应用 Swiper 插件的时候可以将其案例与对应的使用文件进行详细的查看，原来首页的时候就已经应用该插件，所以相信在详情页中对于图片的 Slides 分组模式显示商品小图应用的就是 Swiper 插件应该是能够深入理解了的。如果商品展示图片很多，有十几甚至更多照片时，则可以按 5 个为一组进行分组的轮播切换，这样用户不光可以查看到当前这一角度的图片，可以同时预估到其它几个不同的角度，如果想要进一步查看则可以进行点击切换处理。

显然详情页的页面空间是有限的，所以如果有那么多的展示图的话在轮播图中最好以缩略图的方式进行展示，那么就需要有一定的大图进行进一步的查看。缩略图轮播滑动与大图展示这两者之间应该是两个并列的组件，但它们又需要实现其通讯工作，因为点击缩略图滑动部分需要及时显示对应的大图，那么两个并列的兄弟之间的组件应该如何通讯？其实只需要进行状态提升，将它们两个组件的共用状态提升到它们两个的父组件中即可，比如说图片列表这一数组对象的下标，因为在缩略图轮播图中只需要确认其点击的下标，那么就向父组件传递这一下标值，而父组件中获取到这一下标值以后，通过下标就可以将图片列表中的具体哪张图片传递到图片展示组件中。至于 v-model:xxx 其本质就是父组件传递属性到子组件，而子组件通过 defineEmits 进行 update:xxx 自定义事件的发射修改父组件值的处理。

```vue
<!-- 图片放大查看组件，通过下标获取到图片列表具体位置图片进行展示 -->
<Zoom :img="skuInfo.skuImageList[currentIndex] || {}" />

<!-- 图片列表属性实现轮播图展示，v-model:currentIndex则实现子组件与父组件之间的通讯，将用户点击图片的下标进行子组件传递父组件的操作 -->
<ImageList
  :imageList="skuInfo.skuImageList"
  v-model:currentIndex="currentIndex"
/>
```

事实上图片展示组件中除了获取图片内容进行展示，还需要考虑的是放大镜效果的处理。放大镜的原理其实是一张原图和一张等倍数放大的原图两张图片的对比显示。需要根据移动坐标计算放大部分并让大图跟着反向移动同等倍数，并且给大图套一个放大倍数的 div 让其溢出部分隐藏即可。

![image-20220821153503154](http://qn.chinavanes.com/qiniu_picGo/image-20220821153503154.png)

对于这种单一的功能，完全可以使用第三方的 vue 插件来实现类似功能，比如[vue-image-zoomer](https://samueljon.es/vue-image-zoomer/)、[vue-inner-image-zoom](https://laurenashpole.github.io/vue-inner-image-zoom/#/)等都是一些比较好的选择，这样可以提高项目的开发速度与效率，还可以强化指定功能的用户体验。

## 3)加入购物车

将商品加入到购物车需要考虑的内容其实并不少，因为得确认加入购物车的商品数据是否需要在项目的其它页面或者位置进行显示，比如有的项目会进行购物车数量的统计显示，在头部或者底部显示其统计值。甚至点击其统计数值还可以弹出显示对应的购物车商品的简洁清单进行快速查看。这时候需要考虑的是购物车数据的页面共享问题，不同的页面需要共享购物车的数据，所以可以考虑使用 vuex、pinia 等状态管理器进行购物车清单的统一管理。

<img src="http://qn.chinavanes.com/qiniu_picGo/image-20220821155653293.png" alt="image-20220821155653293" style="zoom: 50%;" />

在将商品加入到购物车的时候是否需要考虑到时效性？因为商品的价格可能存在波动的情况，所以在进行商品购买过程中一定需要确保其“当前时效性”，那么最好的方式就是每个操作过程都与后端接口进行交互。并且，每次购物车流程操作时与后端接口交互还可以保证项目的多端不同平台中的数据保持同步，比如说在电脑上查看网站加入的购物车，在手机上可能进行了小程序端购物车清单的查看，而在 iPad 的 App 应用程序端里进行了删除处理。如果只是实现 vuex、pinia 等状态管理器的操作，就算是应用了本地数据的持久化操作，也无法实现多端多应用数据的同步目标。

所以，在进行购物车操作时一般情况是既要使用本地多页数据共享的状态管理器，又需要使用保持数据同步的接口操作，如何将这两者进行紧密的结合处理就成了购物车流程的核心与关键。

将商品加入购物车还有一个重要的前提是购买商品的数量与库存量之间的关系，用户购买的商品数量是有边界控制的，数量首先不能小于 1，因为购买 0 个商品没有丝毫的意义，而介于商品 SKU 关系的问题，不同的 SKU 销售属性的切换下商品的库存量也会发生变化，那么商品的购买数量能够大于库存量吗？如果库存只有 10 件的时候，用户是否能够购买 100 件呢？显然也是不成的。

应该说商品详情看起来内容简单，但其内容的理解与应用并不容易，特别是 SPU、SKU 概念的理解，购物车数量的控制以及购物车数据与接口的并行操作等都需要逐一深入的理解。
