# 11.购物车清单

## 1)购物车清单数据结构

购物车清单的页面是一个功能十分复杂的页面，首先需要思考的是购物车清单的数据结构，到底是简单的单层数组还是复杂的嵌套数组？不同的电商平台数据结构也是不同，像京东这种多商户集散地的平台，用户在进行商品购买的时候会将不同的商家的订单进行合单处理，因为对于用户来说他们是在京东购买一次商品。至于京东后端如何进行拆单操作则不是用户关心的事情。但是，用户在购物车清单中看到的页面结果则是会有很多不同的商家提供的各式各样的商品，存在的层次是商家为先，商品为后，所以这种购物车清单的数据结构就是典型的二维数组结构。

![image-20220821163552719](http://qn.chinavanes.com/qiniu_picGo/image-20220821163552719.png)

但也有一些电商平台，比如尚品汇，是以单一商户的身份向用户提供商品，但是它的购物车数据结构就是单层的结构了吗？并不是。因为这一平台的购物车数据可能会以活动商品进行分组显示，这样的话同一活动的商品归属一个类别，最终产生的数据仍旧是嵌套数组模式。第一层是活动，第二层才是指定活动下的商品。

<img src="http://qn.chinavanes.com/qiniu_picGo/image-20220821170929783.png" alt="image-20220821171210621" style="zoom:50%;" />

## 2)购物车常见操作功能

既然购物车清单的数据结构是嵌套数组，那么在进行商品数据显示的时候一定需要实现的是嵌套循环的处理，而购物车需要渲染的内容除了商品的图片、名称、价格外还需要动态的改变商品的勾选状态，因为对于购物车来说，生成订单的商品来源是购物车中选中商品的内容。一般对于商品的勾选应该包含单个商品的勾选、分组活动商品的勾选、全部商品的勾选等内容。

除了勾选商品，还需要改变和当然是指定商品的购买数量，因为在修改商品数量的时候则会发生订单金额的变化，但每个商品购买数量按理来说应该仍旧存在该商品购买数量的边界值判断，需要进行约束操作。

实际上商品数量与金额的变化还会引起商品促销活动可选策略的变化，这时候需要理解电商平台常见的促销模式。但电商平台的促销模式众多，这是一个十分复杂的体系，随便列举一下常见的促销模式就包括：打折、积分、买就送、满就送、优惠券、秒杀、团购、会员等级....而像优惠券这种常见的促销活动又包含了不同的类别，比如现金优惠券与满减优惠券，并且不同类别的优惠券又有不同的适应场景，比如全场通用优惠券、指定分类优惠券、指定商品优惠券等。总而言之，购物车中的促销体系是一个十分庞大又繁杂的体系。不过不用担心，一般的平台只会选择常见的一些基础促销模式进行应用，比如优惠券的使用等。

当然，对于购物车的商品我们还是允许用户进行删除操作，或者更应该建议用户将其加入到收藏夹中。

购物车页面中最为关键的部分是根据用户所选商品以及应用的优惠策略进行商品总价的计算与显示，如果价格错误的话，那么对用户对平台都将是致命性的问题。

## 3)购物车常见操作实现

对于购物车嵌套数组的数据结构进行显示需要实现的无非是嵌套的循环遍历而已其难度应该并不是很大，但简单的操作也仅限于购物车的渲染。

对于勾选商品根据之前所述需要处理后端接口，但是这个接口的请求是在哪里实现是值得思考的一个问题，应该是在 vuex 或者 pinia 等状态管理器的 actions 中进行操作，因为不光要进行接口的请求对于页面之间数据共享的操作则需要控制状态管理器中的 state。对于勾选的接口需要后端提供单个商品勾选、多个商品勾选以及全部商品勾选的多个接口。在 actions 中进行接口请求以后需要立即对 state 购物车数据的内容进行状态值的修改，然后将更新后的数据进行渲染显示，所以这里实现的是接口与状态值的结合操作。

对于商品购买数量与促销策略的处理可以根据后端接口的数据返回进行判断，因为不同的商品不同的购买数量产生的促销策略是不同的，所以在修改商品购买数量的时候一定要注意后端返回的促销字段信息内容的变化，并且将这些数据动态渲染于界面当中。

对于购物车常见内容的操作只需要注意一个基本原则就可以，那就是所有的数据都以后端接口返回内容为基准。不要在前端进行商品总价、商品优惠价、购买商品数量等所有内容的计算，不要考虑购买数量与促销策略的组合对价格的影响，总之所有的操作应该都交由后端进行处理前端只进行展示操作。这其中的原因之一是为了项目的时效性，因为前端计算的结果因为用户提交时效性的问题可能价格、促销策略等内容都会在时间段期间发生改变，所以即便前端计算好进行提交后端也可能会验证不通过。原因之二则需要考虑到项目的安全性，因为前端数据被显示于用户端容易被串改，所以为了保证平台的安全与用户操作的安全性，有关购物车、订单与支付等关于资金的操作都应该交由后端进行服务器处理更为妥善也更安全。
