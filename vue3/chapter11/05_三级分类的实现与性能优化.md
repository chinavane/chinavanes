# 05.三级分类的实现与性能优化

当前项目的商品分类控制了联动的级别数量，主要包括三个层级。三级分类的显示不光在首页中有渲染在商品列表等其它页面中也有展示，只不过首页中直接完整显示分类内容，而其它页面中则需要通过鼠标上移才显示下拉模式的三级分类。

首页直接显示一级分类

![image-20220608113333514](http://qn.chinavanes.com/qiniu_picGo/image-20220608113333514.png)

鼠标移动再显示二、三级分类

![image-20220608113203382](http://qn.chinavanes.com/qiniu_picGo/image-20220608113203382.png)

商品列表显示分类导航

![image-20220608114108374](http://qn.chinavanes.com/qiniu_picGo/image-20220608114108374.png)

鼠标上移显示下拉模式各级分类

![image-20220608114130676](http://qn.chinavanes.com/qiniu_picGo/image-20220608114130676.png)

看起来可以在 components 通用组件目录中添加新的导航分类组件，比如 TypeNav。在组件中想要实现 toggle 切换控制分类的显示隐藏需要先理解 vue 当中的原生事件与自定义事件的差异区别，当前应该可以利用 mouseenter、mouseleave 原生事件切换布尔值进而控制分类图层的显示与隐藏。在进行事件监听的时候单行代码的直接书写与多行代码回调函数的调用可以进行区分，通常情况如果只是单一数据赋值操作可以在监听时直接单行代码书写，但如果同一监听事件需要多个功能处理则需要定义回调函数，利用监听绑定对应的回调函数。

因为请求返回的分类内容众多，少则几百，多则上千都有可能，那么在进行多层嵌套循环的时候如果循环渲染路由中`<router-link>`组件，那么将会产生大量组件的动态渲染问题，这将极大的影响项目的总体性能。解决此问题的方式主要可以利用事件委托原理：

- 事件委托也叫事件代理，“事件代理”即是把原本需要绑定在子元素的响应事件(click、keydown…)委托给父元素，让父元素担当事件监听的职务，事件代理的原理是DOM元素的事件冒泡；
- 事件委托的优点就是可以减少事件注册，大量节省内存占用，比如三级分类中去除分类中的`<router-link>`路由组件的生成而直接改用HTML的链接元素标签加快渲染速度，然后将事件委托给父元素监听，利用编程式导航替代声明式导航，从而将成百上千的导航处理优化到一个编程导航功能的实现；
- 利用事件委托可以实现程序从N到1的性能优化，但也会涉及到诸多细节：
  - event.target触发事件元素与event.currentTarget绑定事件元素之间的差异与区别；
  - 元素自定义属性dataset的获取；
  - HTMLAnchorElement类型断言的应用；
  - 点击空白区域跳转问题的判断避免等。
